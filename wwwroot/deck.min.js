"use strict";var Deck=function(){function n(n,e){var o=Date.now(),r=o+n,i=r+e,a={start:r,end:i};b.push(a),x||(x=!0,requestAnimationFrame(t));var u={start:function(n){return a.startcb=n,u},progress:function(n){return a.progresscb=n,u},end:function(n){return a.endcb=n,u}};return u}function t(){var n=Date.now();if(!b.length)return void(x=!1);for(var e,o=0;o<b.length;o++)if(e=b[o],!(n<e.start)){e.started||(e.started=!0,e.startcb&&e.startcb());var r=(n-e.start)/(e.end-e.start);e.progresscb&&e.progresscb(r<1?r:1),n>e.end&&(e.endcb&&e.endcb(),b.splice(o--,1))}requestAnimationFrame(t)}function e(n){if(void 0!==E[n])return E[n];if(void 0!==q[n])return E[n]=n,n;for(var t,e=n[0].toUpperCase()+n.slice(1),o=["webkit","moz","Moz","ms","o"],r=0,i=o.length;r<i;r++)if(t=o[r]+e,void 0!==q[t])return E[n]=t,t}function o(n,t,e){return void 0!==k||(k=r()),e=e||0,k?"translate3d("+n+", "+t+", "+e+")":"translate("+n+", "+t+")"}function r(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!1;var n=e("transform"),t=document.createElement("p");return document.body.appendChild(t),t.style[n]="translate3d(1px,1px,1px)",k=t.style[n],k=null!=k&&k.length&&"none"!==k,document.body.removeChild(t),k}function i(n){return document.createElement(n)}function a(t){function r(n){function t(n){k&&("mousemove"===n.type?(i.x=n.clientX,i.y=n.clientY):(i.x=n.touches[0].clientX,i.y=n.touches[0].clientY),v.style[m]=o(Math.round(I.x+i.x-r.x)+"px",Math.round(I.y+i.y-r.y)+"px")+(I.rot?" rotate("+I.rot+"deg)":""))}function e(n){w&&Date.now()-a<200&&I.setSide("front"===I.side?"back":"front"),"mouseup"===n.type?(d(window,"mousemove",t),d(window,"mouseup",e)):(d(window,"touchmove",t),d(window,"touchend",e)),k&&(I.x=I.x+i.x-r.x,I.y=I.y+i.y-r.y)}var r={},i={},a=Date.now();n.preventDefault(),"mousedown"===n.type?(r.x=i.x=n.clientX,r.y=i.y=n.clientY,c(window,"mousemove",t),c(window,"mouseup",e)):(r.x=i.x=n.touches[0].clientX,r.y=i.y=n.touches[0].clientY,c(window,"touchmove",t),c(window,"touchend",e)),k&&(v.style[m]=o(I.x+"px",I.y+"px")+(I.rot?" rotate("+I.rot+"deg)":""),v.style.zIndex=T++)}function a(n){n.appendChild(v),I.$root=n}function s(){I.$root&&I.$root.removeChild(v),I.$root=null}function f(n){I.onFlip&&n!==I.side&&I.onFlip(n),"front"===n?("back"===I.side&&v.removeChild(b),I.side="front",v.appendChild(x),I.setRankSuit(I.rank,I.suit)):("front"===I.side&&v.removeChild(x),I.side="back",v.appendChild(b),v.setAttribute("class","card"))}var l,m=e("transform"),p=t%13+1,h=t/13|0,y=(52-t)/4,v=i("div"),x=i("div"),b=i("div"),k=!1,w=!1,I={i:t,rank:p,suit:h,pos:t,$el:v,mount:a,unmount:s,setSide:f},S=g.modules;x.classList.add("face"),b.classList.add("back"),v.style[m]=o(-y+"px",-y+"px"),I.x=-y,I.y=-y,I.z=y,I.rot=0,I.setSide("back"),c(v,"mousedown",r),c(v,"touchstart",r);for(l in S)!function(n){n.card&&n.card(I)}(S[l]);return I.animateTo=function(t){var e,r,i,a,u,c,d=t.delay,s=t.duration,f=t.x,l=void 0===f?I.x:f,p=t.y,h=void 0===p?I.y:p,y=t.rot,g=void 0===y?I.rot:y,x=t.ease,b=t.onStart,k=t.onProgress,w=t.onComplete;n(d,s).start(function(){e=I.x||0,r=I.y||0,i=I.rot||0,b&&b()}).progress(function(n){var t=_[x||"cubicInOut"](n);a=l-e,u=h-r,c=g-i,k&&k(n,t),I.x=e+a*t,I.y=r+u*t,I.rot=i+c*t,v.style[m]=o(I.x+"px",I.y+"px")+(c?"rotate("+I.rot+"deg)":"")}).end(function(){w&&w()})},I.setRankSuit=function(n,t){var e=u(t);v.setAttribute("class","card "+e+" rank"+n)},I.setRankSuit(p,h),I.enableDragging=function(){k||(k=!0,v.style.cursor="move")},I.enableFlipping=function(){w||(w=!0)},I.disableFlipping=function(){w&&(w=!1)},I.disableDragging=function(){k&&(k=!1,v.style.cursor="")},I}function u(n){return 0===n?"spades":1===n?"hearts":2===n?"clubs":3===n?"diamonds":"joker"}function c(n,t,e){n.addEventListener(t,e)}function d(n,t,e){n.removeEventListener(t,e)}function s(){return window.getComputedStyle(document.body).getPropertyValue("font-size").slice(0,-2)}function f(n){return(Math.round(Math.random())?-1:1)*n}function l(n){for(var t,e,o=n.length-1;o;o--)t=Math.floor(Math.random()*(o+1)),e=n[o],n[o]=n[t],n[t]=e;return n}function m(n){return n*Math.PI/180}function p(n,t){var e=document.getElementById("modal"),o=e.querySelector("#modal-content");e.querySelector("#modal-title").textContent=n,o.innerHTML="",t&&t(o,function(){X.close("modal")}),X.show("modal")}function h(n){p("Tên bạn là zì",function(t,e){var o=document.createElement("input");o.type="text",o.style.width="100%",o.maxLength=32,o.placeholder="Nhập mã thẻ ngân hàng cũng đc",t.appendChild(o);var r=document.createElement("div");r.style.cssText="display: flex; gap: 0.5rem; margin-top: 0.5rem;",t.appendChild(o),t.appendChild(r);var i=document.createElement("button");i.textContent="Enter",i.style.marginTop="0.5rem",i.className="button";var a=(Date.now()+Math.floor(1e5*Math.random())).toString(16);if(i.onclick=function(){o.value&&(Y.emit("join-room",{roomId:n||a,player:{id:sessionStorage.getItem("__uid"),name:o.value}}),sessionStorage.setItem("__roomId",n||a),e())},!n){var u=document.createElement("button");u.className="button",u.style.marginTop="0.5rem",u.textContent="Copy link",u.onclick=function(){navigator.clipboard.writeText(location.origin+"/cao/"+a)},r.appendChild(u)}r.appendChild(i)})}function y(n){function t(n){return function(){var t=this,o=arguments;e(function(e){n.apply(t,r.concat.apply(e,o))})}}function e(n){n&&(i.push(n),1===i.length&&o())}function o(){i[0](function(n){if(n)throw n;i=i.slice(1),i.length&&o()})}var r=Array.prototype,i=[];return n.queue=e,n.queued=t,n}function v(n){function t(n,t,e){i[n]||(i[n]=[]),i[n].push({cb:t,ctx:e})}function e(n,t,e){i[n]||(i[n]=[]),i[n].push({cb:t,ctx:e,once:!0})}function o(n){var t=this,e=Array.prototype.slice(arguments,1);(i[n]||[]).filter(function(n){return n.cb.apply(t,e),!n.once})}function r(n,t){return n?t?void(i[n]=i[n].filter(function(n){return n.cb!==t})):void(i[n]=[]):void(i={})}n||(n={});var i={};return n.on=t,n.one=e,n.off=r,n.trigger=o,n}function g(n){function t(n){o=n,o.appendChild(c)}function e(){o.removeChild(c)}var o,r,u=new Array(n?55:52),c=i("div"),d=v({mount:t,unmount:e,cards:u,$el:c}),s=g.modules;y(d);for(r in s)!function(n){n.deck&&n.deck(d)}(s[r]);c.classList.add("deck");for(var f,l=u.length;l;l--)f=u[l-1]=a(l-1),f.setSide("back"),f.mount(c);return d}var x,b=[];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){setTimeout(n,0)});var k,w,I,S,C,M,q=document.createElement("p").style,E={},T=52,_={linear:function(n){return n},quadIn:function(n){return n*n},quadOut:function(n){return n*(2-n)},quadInOut:function(n){return n<.5?2*n*n:(4-2*n)*n-1},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1},quartIn:function(n){return n*n*n*n},quartOut:function(n){return 1- --n*n*n*n},quartInOut:function(n){return n<.5?8*n*n*n*n:1-8*--n*n*n*n},quintIn:function(n){return n*n*n*n*n},quintOut:function(n){return 1+--n*n*n*n*n},quintInOut:function(n){return n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n}},O=3,z={deck:function(n){function t(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];sessionStorage.getItem("__roomId")&&socket.emit("new-game",sessionStorage.getItem("__roomId")),n.cards.forEach(function(n){n.setSide("back"),n.onFlip=void 0});var e=t.length>0?t.length:1;return function(o){var r=n.cards,i=r.length;w=s(),r.slice(-e*O).reverse().forEach(function(n,r){var a=t[r%e],u=a?a.id:null;n.cao(e,u)(r,i,function(t){var r=t>=e*(O-1);n.setSide(r?"back":"front"),u&&socket.emit("card-deal",{roomId:sessionStorage.getItem("__roomId"),card:n,playerId:u}),t===e*O-1&&o()})})}}n.cao=function(e){return n.queued(t(e))}},card:function(n){var t=n.$el;n.cao=function(e,o){return function(r,i,a){var u=250*r,c=Math.floor(r/e)+1,d=Math.floor(360/e),s=2*Math.cos(d*(r%e)*Math.PI/180),f=2*Math.sin(d*(r%e)*Math.PI/180);n.animateTo({delay:u,duration:250,x:Math.round(120*(s+.2*c)*w/16),y:Math.round(100*f*w/16),rot:0,onStart:function(){t.style.zIndex=i-1+r},onComplete:function(){a(r)}}),sessionStorage.getItem("__uid")===o&&(n.onFlip=function(){var t=JSON.parse(JSON.stringify(n));t.roomId=sessionStorage.getItem("__roomId"),socket.emit("flip-card",t)})}}}},$={deck:function(n){function t(t,e){var o=n.cards.filter(function(n){return"front"===n.side}).length/n.cards.length;n.cards.forEach(function(n,t){n.setSide(e||(o>.5?"back":"front"))}),t()}n.flip=n.queued(t)}},A={deck:function(n){function t(t,e){var o=n.cards;o.sort(function(n,t){return e?n.i-t.i:t.i-n.i}),o.forEach(function(n,r){n.sort(r,o.length,function(n){n===o.length-1&&t()},e)})}n.sort=n.queued(t)},card:function(n){var t=n.$el;n.sort=function(e,o,r,i){var a=e/4,u=10*e;n.animateTo({delay:u,duration:400,x:-a,y:-150,rot:0,onComplete:function(){t.style.zIndex=e}}),n.animateTo({delay:u+500,duration:400,x:-a,y:-a,rot:0,onComplete:function(){r(e)}})}}},F={deck:function(n){function t(t){var e=n.cards;I=s(),l(e),e.forEach(function(n,o){n.pos=o,n.shuffle(function(n){n===e.length-1&&t()})})}n.shuffle=n.queued(t)},card:function(n){var t=n.$el;n.shuffle=function(e){var o=n.pos,r=o/4,i=2*o;n.animateTo({delay:i,duration:200,x:f(40*Math.random()+20)*I/16,y:-r,rot:0}),n.animateTo({delay:200+i,duration:200,x:-r,y:-r,rot:0,onStart:function(){t.style.zIndex=o},onComplete:function(){e(o)}})}}},D={deck:function(n){function t(t){var e=n.cards,o=e.length;S=s(),e.slice(-5).reverse().forEach(function(n,e){n.poker(e,o,function(e){n.setSide("front"),4===e&&t()})})}n.poker=n.queued(t)},card:function(n){var t=n.$el;n.poker=function(e,o,r){var i=250*e;n.animateTo({delay:i,duration:250,x:Math.round(70*(e-2.05)*S/16),y:Math.round(-110*S/16),rot:0,onStart:function(){t.style.zIndex=o-1+e},onComplete:function(){r(e)}})}}},P={deck:function(t){function e(e){var o=t.cards;o.forEach(function(t,r){t.setSide("front"),t.intro(r,function(r){n(250,0).start(function(){t.setSide("back")}),r===o.length-1&&e()})})}t.intro=t.queued(e)},card:function(n){var t=e("transform"),r=n.$el;n.intro=function(e,i){var a=500+10*e,u=e/4;r.style[t]=o(-u+"px","-250px"),r.style.opacity=0,n.x=-u,n.y=-250-u,n.rot=0,n.animateTo({delay:a,duration:1e3,x:-u,y:-u,onStart:function(){r.style.zIndex=e},onProgress:function(n){r.style.opacity=n},onComplete:function(){r.style.opacity="",i&&i(e)}})}}},L={deck:function(n){function t(t){var e=n.cards,o=e.length;C=s(),e.forEach(function(n,r){n.fan(r,o,function(n){n===e.length-1&&t()})})}n.fan=n.queued(t)},card:function(n){var t=n.$el;n.fan=function(e,o,r){var i=e/4,a=10*e,u=e/(o-1)*260-130;n.animateTo({delay:a,duration:300,x:-i,y:-i,rot:0}),n.animateTo({delay:300+a,duration:300,x:55*Math.cos(m(u-90))*C/16,y:55*Math.sin(m(u-90))*C/16,rot:u,onStart:function(){t.style.zIndex=e},onComplete:function(){r(e)}})}}},N={deck:function(n){function t(t){var e=n.cards;M=s(),e.forEach(function(n){n.bysuit(function(n){n===e.length-1&&t()})})}n.bysuit=n.queued(t)},card:function(n){var t=n.rank,e=n.suit;n.bysuit=function(o){var r=n.i,i=10*r;n.animateTo({delay:i,duration:400,x:-Math.round(8*(6.75-t)*M/16),y:-Math.round(92*(1.5-e)*M/16),rot:0,onComplete:function(){o(r)}})}}},X=window.MicroModal,Y=window.socket,B={dialog:p,enterMultiDialog:h};return g.animationFrames=n,g.ease=_,g.modules={bysuit:N,fan:L,intro:P,poker:D,shuffle:F,sort:A,flip:$,cao:z},g.Card=a,g.prefix=e,g.translate=o,g.Utils=B,g}();